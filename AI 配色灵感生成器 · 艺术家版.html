<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI é…è‰²çµæ„Ÿç”Ÿæˆå™¨ Â· è‰ºæœ¯å®¶ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+SC:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 'sans': ['Inter', 'Noto Sans SC', 'system-ui', 'sans-serif'], },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'fade-in-scale': 'fade-in-scale 0.5s ease-out forwards',
                        'pulse-soft': 'pulse-soft 2.5s ease-in-out infinite',
                        'scroll-horizontal': 'scroll-horizontal 60s linear infinite',
                        'scroll-horizontal-reverse': 'scroll-horizontal-reverse 60s linear infinite',
                        'build-in-up': 'build-in-up 0.7s cubic-bezier(0.215, 0.610, 0.355, 1) forwards',
                        'shimmer-text': 'shimmer-text 3s ease-in-out infinite',
                        'border-pulse': 'border-pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', 'Noto Sans SC', system-ui, sans-serif; background-color: #0f0c29; min-height: 100vh; position: relative; overflow-x: hidden; }
        #interactive-background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background-color: #0f0c29; filter: blur(50px) contrast(20); }
        .glassmorphism { background: rgba(255, 255, 255, 0.12); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.2); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); }
        .glassmorphism-strong { background: rgba(255, 255, 255, 0.97); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.3); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1); }
        .scrolling-wall { display: flex; width: 100%; overflow: hidden; -webkit-mask-image: linear-gradient(to right, transparent, white 10%, white 90%, transparent); mask-image: linear-gradient(to right, transparent, white 10%, white 90%, transparent); }
        .scrolling-wall-content { display: flex; animation: scroll-horizontal 80s linear infinite; }
        .scrolling-wall.reverse .scrolling-wall-content { animation-name: scroll-horizontal-reverse; animation-duration: 70s; }
        .scrolling-wall:hover .scrolling-wall-content { animation-play-state: paused; }
        @keyframes scroll-horizontal { from { transform: translateX(0); } to { transform: translateX(-50%); } }
        @keyframes scroll-horizontal-reverse { from { transform: translateX(-50%); } to { transform: translateX(0); } }
        .color-card { flex: 0 0 auto; width: 150px; height: 150px; margin: 0 1rem; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform-style: preserve-3d; perspective: 1000px; }
        .color-card .color-block { width: 100%; height: 100%; transition: all 0.4s ease; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .color-card .color-code { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .color-card:hover .color-block { transform: scale(1.1) translateY(-10px) rotateY(-8deg) rotateX(8deg); box-shadow: 0 25px 50px -12px var(--color-shadow, rgba(0,0,0,0.4)); }
        .color-card:hover .color-code { transform: translateY(-8px); }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: 600; padding: 16px 32px; border-radius: 50px; border: none; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4); position: relative; overflow: hidden; }
        .btn-primary::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.5s ease; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6); }
        .btn-primary:active { transform: translateY(0px) scale(0.98); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5); }
        .btn-primary:hover::before { left: 100%; }
        .btn-primary:disabled { background: #94a3b8; box-shadow: none; transform: none; cursor: not-allowed; }
        .btn-secondary { padding: 10px 20px; background: rgba(255, 255, 255, 0.5); backdrop-filter: blur(5px); border: 1px solid rgba(255, 255, 255, 0.7); color: #4b5563; font-weight: 600; border-radius: 50px; transition: all 0.3s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .btn-secondary:hover { background: rgba(255, 255, 255, 0.8); box-shadow: 0 7px 14px rgba(0,0,0,0.07); transform: translateY(-2px); }
        .btn-secondary:active { transform: translateY(0) scale(0.98); }
        .gradient-text { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .loader-container { display: flex; justify-content: center; align-items: center; width: 100%; height: 60px; }
        .loader { display: flex; align-items: center; justify-content: center; }
        .loader-bar { width: 10px; height: 50px; margin: 0 5px; border-radius: 5px; background-color: #667eea; animation: loader-pulse 1.2s ease-in-out infinite; }
        .loader-bar:nth-child(2) { animation-delay: 0.15s; } .loader-bar:nth-child(3) { animation-delay: 0.3s; } .loader-bar:nth-child(4) { animation-delay: 0.45s; }
        @keyframes loader-pulse { 0%, 100% { transform: scaleY(0.4); } 50% { transform: scaleY(1); } }
        .palette-card { background: white; border-radius: 20px; padding: 24px; transition: all 0.3s ease; border: 1px solid rgba(0,0,0,0.05); position: relative; overflow: hidden; transform-style: preserve-3d; }
        .palette-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--primary-color, #667eea); }
        .palette-card:hover { transform: translateY(-5px) rotateY(-3deg); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .input-field { background: rgba(255, 255, 255, 0.9); border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 16px; padding: 16px 20px; font-size: 16px; transition: all 0.3s ease; backdrop-filter: blur(10px); }
        .input-field:focus { outline: none; border-color: #667eea; background: rgba(255, 255, 255, 0.95); box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1); }
        .hero-title { font-size: clamp(2.5rem, 8vw, 4.5rem); font-weight: 800; line-height: 1.1; margin-bottom: 24px; color: white; text-shadow: 0 4px 20px rgba(0,0,0,0.2); }
        .mockup-container { background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-radius: 20px; padding: 32px; transition: all 0.3s ease; position: relative; overflow: hidden; min-height: 350px; display: flex; justify-content: center; align-items: center; border: 2px solid transparent; }
        .mockup-container.is-loading { border-image: conic-gradient(from var(--angle), #8b5cf6, #ec4899, #f59e0b, #84cc16, #3b82f6, #8b5cf6) 1; animation: border-pulse 2s linear infinite; --angle: 0deg; }
        @keyframes border-pulse { to { --angle: 360deg; } }
        .shimmer { background-color: #e2e8f0; background-image: linear-gradient(90deg, #e2e8f0, #f8fafc, #e2e8f0); background-size: 200px 100%; background-repeat: no-repeat; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: -200px 0; } 100% { background-position: calc(200px + 100%) 0; } }
        @keyframes build-in-up { from { opacity: 0; transform: translateY(30px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
        .build-in-item { opacity: 0; animation-name: build-in-up; animation-fill-mode: forwards; }
        /* *** NEW: API Key Modal Styles *** */
        .api-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px); z-index: 1000; display: flex; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; }
        .api-modal-overlay.visible { opacity: 1; pointer-events: auto; }
        .api-modal-content { background: white; padding: 32px; border-radius: 20px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); max-width: 500px; width: 90%; transform: scale(0.95); transition: transform 0.3s ease; }
        .api-modal-overlay.visible .api-modal-content { transform: scale(1); }
    </style>
</head>
<body class="text-gray-900">

    <canvas id="interactive-background"></canvas>
    
    <!-- *** NEW: Settings Button *** -->
    <button id="settings-btn" title="è®¾ç½®API Key" class="fixed top-6 right-6 z-50 w-12 h-12 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center border border-white/30 text-white hover:bg-white/30 transition-all duration-300 shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
    </button>
    
    <!-- *** NEW: API Key Modal Structure *** -->
    <div id="api-key-modal" class="api-modal-overlay">
        <div class="api-modal-content">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">è®¾ç½® Gemini API Key</h2>
            <p class="text-gray-600 mb-6">è¯·è¾“å…¥æ‚¨çš„Google Gemini API Keyä»¥å¯ç”¨AIåŠŸèƒ½ã€‚æ‚¨çš„Keyå°†ä»…ä¿å­˜åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚ä½ å¯ä»¥åœ¨https://aistudio.google.com/è·å–å…è´¹çš„API Keyã€‚</p>
            <div>
                <label for="api-key-input" class="font-semibold text-gray-700 block mb-2">API Key</label>
                <input id="api-key-input" type="password" placeholder="ç²˜è´´æ‚¨çš„API Key..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
            </div>
            <div class="flex justify-end gap-4 mt-8">
                <button id="api-key-cancel" class="btn-secondary">å–æ¶ˆ</button>
                <button id="api-key-save" class="btn-primary !px-8 !py-3">ä¿å­˜</button>
            </div>
        </div>
    </div>
    
    <div id="app-container" class="min-h-screen p-4 sm:p-8 relative z-10">
        <div id="main-page" class="max-w-7xl mx-auto">
             <!-- Main page content unchanged -->
             <header class="text-center py-16">
                <div class="inline-flex items-center bg-white/20 backdrop-blur-sm border border-white/30 text-white py-2 px-5 rounded-full mb-8 text-sm font-semibold shadow-lg animate-fade-in-scale">
                    <div class="w-2 h-2 bg-green-400 rounded-full mr-3 animate-pulse"></div>
                    Powered by Gemini AI - Designed by Wu Shangru
                </div>
                <h1 class="hero-title animate-fade-in-scale" style="animation-delay: 0.1s;">AI é…è‰²çµæ„Ÿç”Ÿæˆå™¨-By å´å°šå„’</h1>
                <p class="text-xl text-white/90 mt-6 max-w-3xl mx-auto leading-relaxed font-medium animate-fade-in-scale" style="animation-delay: 0.2s;">
                    æ¢ç´¢æ— é™åˆ›æ„ï¼Œå°†ä½ çš„æƒ³è±¡è½¬åŒ–ä¸º<span class="font-semibold" style="color: #f0c55a;">ç‹¬ç‰¹çš„è‰²å½©è¯­è¨€</span>
                </p>
            </header>
            
            <section class="max-w-4xl mx-auto mb-20 animate-fade-in-scale" style="animation-delay: 0.3s;">
                <div class="glassmorphism rounded-3xl p-8 md:p-12 shadow-2xl">
                    <div class="text-center mb-8">
                        <h2 class="text-3xl font-bold text-white mb-4">âœ¨ æ–‡å­—åŒ–èº«è‰²å½©</h2>
                        <p class="text-white/80 text-lg">æè¿°ä½ çš„åˆ›æ„ã€æƒ…æ„Ÿæˆ–åœºæ™¯ï¼Œè®©AIä¸ºä½ åˆ›é€ ä¸“å±é…è‰²æ–¹æ¡ˆ</p>
                    </div>
                    <div class="space-y-6">
                        <textarea id="text-input" class="w-full input-field resize-none text-gray-800" rows="4" placeholder="ä¾‹å¦‚ï¼šåˆå¤œåŸå¸‚çš„éœ“è™¹ç¯å…‰ï¼Œæ¸©æš–çš„å’–å•¡å…æ°›å›´ï¼Œæ˜¥æ—¥æ¨±èŠ±é£èˆçš„å…¬å›­..."></textarea>
                        <div class="text-center">
                            <button id="text-generate-btn" class="btn-primary text-lg">ğŸ¨ ç”Ÿæˆä¸“å±é…è‰²æ–¹æ¡ˆ</button>
                        </div>
                    </div>
                </div>
            </section>

            <main class="animate-fade-in-scale space-y-8" style="animation-delay: 0.4s;">
                <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                    <div>
                        <h2 class="text-4xl font-bold text-white mb-3">è‰²å½©çµæ„Ÿå¢™</h2>
                        <p class="text-white/80 text-lg">ç‚¹å‡»ä»»æ„é¢œè‰²ï¼Œå¼€å¯ä½ çš„è®¾è®¡ä¹‹æ—…</p>
                    </div>
                    <button id="refresh-btn" class="mt-6 md:mt-0 px-6 py-3 bg-white/20 backdrop-blur-sm text-white font-semibold rounded-full border border-white/30 hover:bg-white/30 transition-all duration-300 shadow-lg active:scale-95">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2 transition-transform duration-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V4a1 1 0 011-1zm10 8a1 1 0 01.885.498A5.002 5.002 0 015.899 16H9a1 1 0 110 2H4a1 1 0 01-1-1v-5a1 1 0 112 0v2.101a7.002 7.002 0 0111.601-2.566 1 1 0 01.115-1.002z" clip-rule="evenodd" /></svg>
                        åˆ·æ–°çµæ„Ÿ
                    </button>
                </div>
                <div id="wall-container" class="space-y-8"></div>
            </main>
        </div>
        <div id="detail-page" class="hidden max-w-6xl mx-auto"></div>
    </div>

    <script type="module">
        const state = { currentPaletteData: null };
        const elements = { mainPage: document.getElementById('main-page'), wallContainer: document.getElementById('wall-container'), detailPage: document.getElementById('detail-page'), refreshBtn: document.getElementById('refresh-btn'), textInput: document.getElementById('text-input'), textGenerateBtn: document.getElementById('text-generate-btn'), settingsBtn: document.getElementById('settings-btn'), apiKeyModal: document.getElementById('api-key-modal'), apiKeyInput: document.getElementById('api-key-input'), apiKeySaveBtn: document.getElementById('api-key-save'), apiKeyCancelBtn: document.getElementById('api-key-cancel'), };
        
        // *** API KEY is now managed from localStorage ***
        let API_KEY = localStorage.getItem('geminiApiKey') || '';
        const MODEL_NAME = 'gemini-2.5-flash-lite-preview-06-17';
        
        // --- Background & Basic AI Fetching logic are mostly unchanged ---
        const canvas = document.getElementById('interactive-background'); const ctx = canvas.getContext('2d'); let balls = [], mouse = { x: undefined, y: undefined, radius: 120 }; const backgroundColors = ["#5e72eb", "#00c9a7", "#f37a7a", "#a1c4fd", "#ffc482", "#d4a5a5", "#a2d2ff", "#fbc7f7"]; let animationFrameId, isAnimating = false, inactivityTimer;
        class Ball { constructor(x, y, radius, color) { this.x = x || Math.random() * canvas.width; this.y = y || Math.random() * canvas.height; this.radius = radius; this.color = color; this.vx = (Math.random() - 0.5) * 1.8; this.vy = (Math.random() - 0.5) * 1.8; this.originalVx = this.vx; this.originalVy = this.vy; } draw() { ctx.beginPath(); ctx.fillStyle = this.color; ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2); ctx.fill(); } update() { if (mouse.x !== undefined) { const dx = this.x - mouse.x; const dy = this.y - mouse.y; const dist = Math.sqrt(dx * dx + dy * dy); if (dist < mouse.radius) { const force = (mouse.radius - dist) / mouse.radius; this.x += (dx / dist) * force * 2.5; this.y += (dy / dist) * force * 2.5; } } this.vx += (this.originalVx - this.vx) * 0.02; this.vy += (this.originalVy - this.vy) * 0.02; if (this.x + this.radius > canvas.width || this.x - this.radius < 0) this.vx = -this.vx; if (this.y + this.radius > canvas.height || this.y - this.radius < 0) this.vy = -this.vy; this.x += this.vx; this.y += this.vy; } }
        function initCanvas() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; balls = []; const ballCount = Math.floor(canvas.width * canvas.height / 35000); for (let i = 0; i < ballCount; i++) { const radius = Math.random() * 80 + 70; const color = backgroundColors[Math.floor(Math.random() * backgroundColors.length)]; balls.push(new Ball(null, null, radius, color)); } }
        function animateCanvas() { if (!isAnimating) return; ctx.clearRect(0, 0, canvas.width, canvas.height); balls.forEach(ball => { ball.update(); ball.draw(); }); animationFrameId = requestAnimationFrame(animateCanvas); }
        function startAnimation() { if (!isAnimating) { isAnimating = true; animateCanvas(); } }
        function stopAnimation() { isAnimating = false; cancelAnimationFrame(animationFrameId); }
        async function fetchFromAI(prompt, expectJson = true) { const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`; const requestBody = { contents: [{ parts: [{ text: prompt }] }] }; if (expectJson) { requestBody.generationConfig = { responseMimeType: "application/json" }; } try { const response = await fetch(API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(requestBody) }); if (!response.ok) { const errorData = await response.json().catch(() => ({ error: { message: "Unknown API error" } })); throw new Error(errorData.error.message || `HTTP error! status: ${response.status}`); } const data = await response.json(); if (!data.candidates || data.candidates.length === 0 || !data.candidates[0].content.parts[0].text) { throw new Error("AI did not return valid content."); } let rawText = data.candidates[0].content.parts[0].text; if (expectJson) { try { return JSON.parse(rawText); } catch (e) { console.error("JSON parsing error:", e, "Raw response:", rawText); return { error: true, message: `AI returned invalid JSON (${e.message}).` }; } } return rawText.trim(); } catch (error) { console.error('Error calling AI API:', error); return { error: true, message: error.message }; } }
        function getColorDetails(colorHex) { const prompt = `ä½ æ˜¯ä¸€ä½é¡¶çº§è‰²å½©è®¾è®¡å¸ˆå’Œè¯—äººã€‚ç”¨æˆ·é€‰æ‹©äº†é¢œè‰²: ${colorHex}ã€‚è¯·ä¸ºå®ƒåˆ›é€ ä¸€ä¸ªå¯Œæœ‰è¯—æ„çš„æ•…äº‹å’Œå®Œæ•´çš„é…è‰²æ–¹æ¡ˆã€‚ä¸¥æ ¼æŒ‰JSONæ ¼å¼è¿”å›ï¼Œä¸è¦æœ‰ä»»ä½•æ³¨é‡Šæˆ–å¤šä½™æ–‡å­—ï¼š { "name": "å¯Œæœ‰è¯—æ„å’Œåˆ›æ„çš„åå­—", "description": "2-3å¥ä¼˜ç¾çš„è‰ºæœ¯åŒ–æè¿°ï¼Œè¦æœ‰æƒ³è±¡åŠ›å’Œæƒ…æ„Ÿ", "palette": { "primary": {"name": "ä¸»è‰²è°ƒ", "color": "${colorHex}", "description": "ç”¨æˆ·é€‰æ‹©çš„æ ¸å¿ƒé¢œè‰²ï¼Œä½“ç°ä¸»è¦æƒ…ç»ªã€‚"}, "complementary": {"name": "å¯¹æ¯”è‰²", "color": "#äº’è¡¥è‰²HEX", "description": "åˆ›é€ å¼ºçƒˆè§†è§‰å†²å‡»çš„å¯¹æ¯”è‰²ã€‚"}, "analogous": {"name": "å’Œè°è‰²", "color": "#é‚»è¿‘è‰²HEX", "description": "è¥é€ æ¸©å’Œã€ç»Ÿä¸€æ°›å›´çš„é‚»è¿‘è‰²ã€‚"}, "neutral": {"name": "å¹³è¡¡è‰²", "color": "#ä¸­æ€§è‰²HEX", "description": "æå‡æ•´ä½“è´¨æ„Ÿçš„ä¸­æ€§è‰²è°ƒã€‚"} } }`; return fetchFromAI(prompt); }
        function getColorDetailsFromText(description) { const prompt = `ä½œä¸ºä¸€åé¡¶å°–é…è‰²è®¾è®¡å¸ˆï¼Œè¯·å°†ç”¨æˆ·çš„æè¿°ï¼š"${description}"è½¬åŒ–ä¸ºä¸€ä¸ªå®Œæ•´çš„4è‰²é…è‰²æ–¹æ¡ˆã€‚è¦å¯Œæœ‰åˆ›æ„å’Œè‰ºæœ¯æ„Ÿã€‚ä¸¥æ ¼æŒ‰JSONæ ¼å¼è¿”å›ï¼Œä¸è¦æœ‰ä»»ä½•æ³¨é‡Šæˆ–å¤šä½™æ–‡å­—ï¼š { "name": "ä¸ºè¿™ä¸ªé…è‰²æ–¹æ¡ˆèµ·ä¸€ä¸ªè¯—æ„è€Œç‹¬ç‰¹çš„åå­—", "description": "2-3å¥è¯è§£é‡Šè¿™ä¸ªé…è‰²å¦‚ä½•å®Œç¾ä½“ç°ç”¨æˆ·çš„æè¿°ï¼Œè¦æœ‰è‰ºæœ¯æ„Ÿ", "palette": { "primary": {"name": "ä¸»é¢˜è‰²", "color": "#ä¸»é¢˜è‰²HEX", "description": "å¥ å®šæ•´ä½“åŸºè°ƒçš„æ ¸å¿ƒé¢œè‰²ã€‚"}, "secondary": {"name": "è¾…åŠ©è‰²", "color": "#è¾…åŠ©è‰²HEX", "description": "å®Œç¾è¡¥å……ä¸»è‰²çš„ç¬¬äºŒè‰²å½©ã€‚"}, "accent": {"name": "ç‚¹ç¼€è‰²", "color": "#å¼ºè°ƒè‰²HEX", "description": "ç”¨äºçªå‡ºé‡ç‚¹çš„äº®çœ¼è‰²å½©ã€‚"}, "background": {"name": "èƒŒæ™¯è‰²", "color": "#èƒŒæ™¯è‰²HEX", "description": "è¥é€ å®Œç¾æ°›å›´çš„åº•è‰²ã€‚"} } }`; return fetchFromAI(prompt); }
        
        function isColorDark(hexColor) { if (!hexColor) return true; const hex = hexColor.replace('#', ''); const r = parseInt(hex.substring(0, 2), 16); const g = parseInt(hex.substring(2, 4), 16); const b = parseInt(hex.substring(4, 6), 16); const luminance = (0.299 * r + 0.587 * g + 0.114 * b); return luminance < 128; }

        // *** UPGRADED: The "Artist" Prompt - Unleashes Creativity! ***
        function generateUiMockup(paletteData) {
            const { name, description, palette } = paletteData;
            const bgColor = palette.background?.color || palette.neutral.color;
            const contrastInstruction = isColorDark(bgColor) ? "èƒŒæ™¯æ˜¯æ·±è‰²ã€‚ä¸ºäº†ä¿è¯å¯è¯»æ€§ï¼Œä¸»è¦æ–‡æœ¬å†…å®¹å¿…é¡»ä½¿ç”¨æµ…è‰²ã€‚" : "èƒŒæ™¯æ˜¯æµ…è‰²ã€‚ä¸ºäº†ä¿è¯å¯è¯»æ€§ï¼Œä¸»è¦æ–‡æœ¬å†…å®¹å¿…é¡»ä½¿ç”¨æ·±è‰²ã€‚";

            const prompt = `
            ä½ æ˜¯ä¸€ä½æå¯Œåˆ›é€ åŠ›çš„å‰ç«¯UIè‰ºæœ¯å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ²‰æµ¸åœ¨ç»™å®šçš„ä¸»é¢˜ä¸­ï¼Œè®¾è®¡ä¸€ä¸ªä»¤äººæƒŠè‰³çš„UIç•Œé¢ã€‚

            **æ ¸å¿ƒä¸»é¢˜:**
            - **åç§°:** "${name}"
            - **æ•…äº‹:** "${description}"

            **ä½ çš„è°ƒè‰²ç›˜ (CSS å˜é‡):**
            - ä¸»é¢˜è‰²: var(--color-primary)
            - è¾…åŠ©è‰²: var(--color-secondary)
            - ç‚¹ç¼€è‰²: var(--color-accent)
            - èƒŒæ™¯è‰²: var(--color-background)

            **è®¾è®¡æŒ‡å¯¼:**
            1.  **æ„Ÿå—ä¸»é¢˜:** è®©ä½ çš„è®¾è®¡çœŸå®åœ°åæ˜ å‡º"${name}"è¿™ä¸ªä¸»é¢˜çš„çµé­‚å’Œæƒ…æ„Ÿã€‚
            2.  **è‰ºæœ¯é£æ ¼å‚è€ƒ (æ±²å–çµæ„Ÿï¼Œä¸å¿…æ‹˜æ³¥):** ç»ç’ƒæ‹Ÿç‰©(Glassmorphism), æ›™å…‰UI(Aurora UI), æç®€ä¸»ä¹‰, èµ›åšæœ‹å…‹, å¤å¤æœªæ¥ä¸»ä¹‰, æœ‰æœºè®¾è®¡ã€‚
            3.  **å¯¹æ¯”åº¦:** ${contrastInstruction}
            4.  **å›¾æ ‡/å›¾åƒ:** **ç»å¯¹ç¦æ­¢ä½¿ç”¨ \`<img>\` æ ‡ç­¾æˆ–å¤–éƒ¨å›¾ç‰‡URLã€‚** å¦‚æœéœ€è¦ï¼Œè¯·**å†…è”ç”ŸæˆSVG**ï¼Œå¹¶ç”¨CSSå˜é‡ä¸ºå…¶ä¸Šè‰²(e.g. \`<svg fill="var(--color-primary)">\`)ã€‚
            **æœ€ç»ˆè¾“å‡ºè§„åˆ™:**
            - **åªè¿”å›HTMLä»£ç :** ä½ çš„å›ç­”å¿…é¡»æ˜¯çº¯ç²¹çš„HTMLï¼Œç›´æ¥ä»¥ \`<div ...>\` å¼€å§‹ã€‚**ç»å¯¹ç¦æ­¢**åŒ…å«ä»»ä½•è§£é‡Šæ€§æ–‡å­—ã€markdown (\`\`\`html\`)ã€\`<html>\` æˆ– \`<body>\` æ ‡ç­¾ã€‚
            - **ä¸¥æ ¼ä½¿ç”¨CSSå˜é‡:** åœ¨Tailwind classä¸­ä½¿ç”¨æˆ‘æä¾›çš„CSSå˜é‡è¿›è¡Œä¸Šè‰²ã€‚
            `;
            return fetchFromAI(prompt, false);
        }
        // --- UI Rendering, Animation, and Utility functions ---
        function switchView(viewName) { window.scrollTo({ top: 0, behavior: 'smooth' }); if (viewName === 'grid') { elements.mainPage.classList.remove('hidden'); elements.detailPage.classList.add('hidden'); elements.detailPage.innerHTML = ''; document.getElementById('palette-styles')?.remove(); elements.textInput.focus(); } else { elements.mainPage.classList.add('hidden'); elements.detailPage.classList.remove('hidden'); setTimeout(() => { const title = elements.detailPage.querySelector('h2'); if (title) { title.setAttribute('tabindex', '-1'); title.focus(); } }, 100); } }
        function populateScrollingWalls() { const wallContainer = elements.wallContainer; wallContainer.innerHTML = ''; for (let j = 0; j < 3; j++) { const wall = document.createElement('div'); wall.className = 'scrolling-wall'; const content = document.createElement('div'); content.className = 'scrolling-wall-content'; if (j === 1) { wall.classList.add('reverse'); content.style.animationDuration = '75s'; } else { content.style.animationDuration = j === 0 ? '90s' : '65s'; } const createColorCards = () => { const fragment = document.createDocumentFragment(); for (let i = 0; i < 30; i++) { const color = '#' + Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0'); const cardWrapper = document.createElement('div'); cardWrapper.className = 'color-card group'; cardWrapper.style.setProperty('--color-shadow', hexToRgba(color, 0.4)); const colorBlock = document.createElement('div'); colorBlock.className = 'color-block w-full h-full rounded-2xl cursor-pointer'; colorBlock.style.backgroundColor = color; colorBlock.dataset.color = color; colorBlock.innerHTML = `<div class="color-code absolute inset-x-0 bottom-2 bg-black/30 text-white text-xs p-1 rounded-full opacity-0 group-hover:opacity-100 transition-all duration-300 text-center font-mono w-24 mx-auto">${color.toUpperCase()}</div>`; cardWrapper.appendChild(colorBlock); fragment.appendChild(cardWrapper); } return fragment; }; const firstBatch = createColorCards(); const secondBatch = firstBatch.cloneNode(true); content.appendChild(firstBatch); content.appendChild(secondBatch); wall.appendChild(content); wallContainer.appendChild(wall); } }
        function hexToRgb(hex) { if (!hex) return 'N/A'; const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex); return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : 'N/A'; }
        function copyToClipboard(text, targetElement) { if (navigator.clipboard) { navigator.clipboard.writeText(text).then(() => { const originalText = targetElement.textContent; targetElement.textContent = 'å·²å¤åˆ¶!'; targetElement.style.color = '#10b981'; setTimeout(() => { targetElement.textContent = originalText; targetElement.style.color = ''; }, 1500); }).catch(err => console.error('å¤åˆ¶å¤±è´¥: ', err)); } else { const textArea = document.createElement("textarea"); textArea.value = text; document.body.appendChild(textArea); textArea.focus(); textArea.select(); try { document.execCommand('copy'); const originalText = targetElement.textContent; targetElement.textContent = 'å·²å¤åˆ¶!'; targetElement.style.color = '#10b981'; setTimeout(() => { targetElement.textContent = originalText; targetElement.style.color = ''; }, 1500); } catch (err) { console.error('Fallback: unable to copy', err); } document.body.removeChild(textArea); } }
        function hexToRgba(hex, alpha) { if (!hex || hex.length < 4) hex = '#FFFFFF'; const r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16); return `rgba(${r}, ${g}, ${b}, ${alpha})`; }
        function renderSkeleton() { switchView('detail'); elements.detailPage.innerHTML = `<div class="glassmorphism-strong rounded-3xl shadow-2xl p-8 md:p-12 animate-fade-in-scale"><div class="flex justify-between items-start gap-6 mb-12"><div class="w-2/3 h-12 rounded-lg shimmer"></div><div class="w-32 h-12 rounded-full shimmer"></div></div><div class="flex flex-col md:flex-row gap-8 mb-16"><div class="md:w-1/3"><div class="w-full h-64 rounded-3xl shimmer"></div></div><div class="md:w-2/3 space-y-4"><div class="h-8 w-1/3 rounded-lg shimmer"></div><div class="h-6 w-full rounded-lg shimmer"></div><div class="h-6 w-5/6 rounded-lg shimmer"></div></div></div><div class="h-10 w-1/2 rounded-lg shimmer mb-8"></div><div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-16"><div class="h-28 w-full rounded-2xl shimmer"></div><div class="h-28 w-full rounded-2xl shimmer"></div><div class="h-28 w-full rounded-2xl shimmer"></div><div class="h-28 w-full rounded-2xl shimmer"></div></div><div class="w-full h-64 rounded-2xl shimmer"></div></div>`; }
        function injectPaletteAsCssVariables(palette) { document.getElementById('palette-styles')?.remove(); const style = document.createElement('style'); style.id = 'palette-styles'; style.innerHTML = `:root { --color-primary: ${palette.primary.color}; --color-secondary: ${palette.secondary?.color || palette.analogous.color}; --color-accent: ${palette.accent?.color || palette.complementary.color}; --color-background: ${palette.background?.color || palette.neutral.color}; }`; document.head.appendChild(style); }
        function extractHtmlFromAiResponse(rawText) { const codeBlockMatch = rawText.match(/```(?:html)?\s*([\s\S]*?)\s*```/); if (codeBlockMatch && codeBlockMatch[1]) { return codeBlockMatch[1].trim(); } const firstTagIndex = rawText.indexOf('<'); const lastTagIndex = rawText.lastIndexOf('>'); if (firstTagIndex !== -1 && lastTagIndex !== -1 && lastTagIndex > firstTagIndex) { return rawText.substring(firstTagIndex, lastTagIndex + 1).trim(); } return rawText.trim(); }
        function renderLiveBuildUI(html, container) { container.innerHTML = ''; const parser = new DOMParser(); const doc = parser.parseFromString(`<div id="ai-wrapper">${html}</div>`, 'text/html'); const wrapper = doc.getElementById('ai-wrapper'); if (!wrapper || !wrapper.hasChildNodes()) { container.innerHTML = `<div class="text-center py-16 text-orange-500 p-4 animate-fade-in-scale">AIæœªèƒ½ç”Ÿæˆæœ‰æ•ˆçš„UIç»„ä»¶ï¼Œè¯·å°è¯•åˆ·æ–°ã€‚</div>`; return; } const allElements = wrapper.querySelectorAll('*'); allElements.forEach((el, index) => { el.classList.add('build-in-item'); el.style.animationDelay = `${index * 40}ms`; }); while (wrapper.firstChild) { container.appendChild(wrapper.firstChild); } }
        async function triggerAutomaticMockupGeneration() { if (!state.currentPaletteData) return; const container = document.getElementById('ui-mockup-container'); const button = document.querySelector('button[data-action="generate-mockup"]'); if (!container || !button) return; container.classList.add('is-loading'); container.innerHTML = `<div class="flex justify-center items-center py-16 animate-fade-in-scale"><div class="text-center"><div class="loader-container !h-12 !mb-4"><div class="loader"><div class="loader-bar !bg-indigo-400 !w-2 !h-8"></div><div class="loader-bar !bg-indigo-400 !w-2 !h-8"></div><div class="loader-bar !bg-indigo-400 !w-2 !h-8"></div><div class="loader-bar !bg-indigo-400 !w-2 !h-8"></div></div></div><p class="text-gray-600 text-lg font-medium">AIè‰ºæœ¯å®¶æ­£åœ¨æŒ¥æ´’åˆ›æ„...</p></div></div>`; button.disabled = true; const mockupHtmlRaw = await generateUiMockup(state.currentPaletteData); container.classList.remove('is-loading'); if (mockupHtmlRaw.error) { container.innerHTML = `<div class="text-center py-16 text-red-500 p-4 animate-fade-in-scale">ç”Ÿæˆå¤±è´¥: ${mockupHtmlRaw.message}</div>`; } else { const mockupHtml = extractHtmlFromAiResponse(mockupHtmlRaw); renderLiveBuildUI(mockupHtml, container); } button.disabled = false; }
        async function renderDetailPageStreamed(aiData) { if (aiData.error) { elements.detailPage.innerHTML = `<div class="glassmorphism-strong rounded-3xl p-12 text-center max-w-2xl mx-auto animate-fade-in-scale"><div class="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6"><svg class="w-10 h-10 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.864-.833-2.634 0L4.17 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg></div><h2 class="text-3xl font-bold text-red-600 mb-4">å“å‘€ï¼Œå‡ºç°äº†é—®é¢˜</h2><p class="text-gray-600 mb-8 text-lg">${aiData.message}</p><button data-action="back" class="btn-primary">è¿”å›ç»§ç»­æ¢ç´¢</button></div>`; return; } state.currentPaletteData = aiData; const sourceColor = aiData.palette.primary.color; elements.detailPage.innerHTML = `<div class="glassmorphism-strong rounded-3xl shadow-2xl p-8 md:p-12 animate-fade-in-scale"><div class="flex flex-col md:flex-row justify-between items-start gap-6 mb-12"><div class="flex-grow"><h2 id="detail-title" class="text-4xl md:text-5xl font-bold mb-6 gradient-text shimmer-text" style="min-height: 60px;"></h2></div><button data-action="back" class="btn-secondary">â† è¿”å›æ¢ç´¢</button></div><div id="main-content-flex" class="flex flex-col md:flex-row md:items-start gap-8 mb-16"><div id="main-color-container" style="transition: flex-basis 1s cubic-bezier(0.23, 1, 0.32, 1); flex-basis: 100%;"><div id="main-color-block" class="reveal-item w-full h-64 rounded-3xl shadow-2xl relative overflow-hidden" style="background-color: ${sourceColor};"><div class="absolute inset-0 bg-gradient-to-br from-transparent via-white/10 to-transparent"></div><div class="absolute inset-0 animate-pulse-soft rounded-3xl" style="box-shadow: 0 0 0 0 ${sourceColor};"></div><div class="absolute bottom-4 left-4 right-4"><div class="bg-black/30 backdrop-blur-sm rounded-2xl p-4 text-white"><div class="font-mono text-lg font-bold cursor-pointer" data-copy-text="${sourceColor.toUpperCase()}">${sourceColor.toUpperCase()}</div><div class="text-sm opacity-90 cursor-pointer" data-copy-text="${hexToRgb(sourceColor)}">RGB(${hexToRgb(sourceColor)})</div></div></div></div></div><div id="description-container" class="space-y-6" style="transition: flex-basis 1s cubic-bezier(0.23, 1, 0.32, 1), opacity 0.6s ease-out 0.2s; flex-basis: 0%; opacity: 0;"><div id="detail-description" class="reveal-item"><h3 class="text-2xl font-bold text-gray-800 mb-4">è‰²å½©æ•…äº‹</h3><p class="text-xl text-gray-600 leading-relaxed italic"></p></div></div></div><div class="mb-16"><div class="reveal-item mb-8"><div class="flex justify-between items-center mb-4"><div class="flex-grow"><h3 class="text-3xl font-bold text-gray-900 mb-1">AI é…è‰²æ–¹æ¡ˆ</h3><p class="text-gray-600 text-lg">åŸºäºè‰²å½©ç†è®ºç”Ÿæˆçš„å®Œç¾æ­é…</p></div><button data-action="copy-palette" class="btn-secondary">å¤åˆ¶ä¸ºCSS</button></div></div><div id="palette-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div></div><div class="reveal-item"><div class="text-center mb-8"><h3 class="text-3xl font-bold text-gray-900 mb-3">è®¾è®¡åº”ç”¨ç¤ºä¾‹</h3><p class="text-gray-600 text-lg mb-8">AIè‰ºæœ¯å®¶æ­£åœ¨å°†è‰²å½©è½¬åŒ–ä¸ºå¯äº¤äº’çš„UIç»„ä»¶...</p><div class="flex justify-center items-center gap-4"><button data-action="generate-mockup" class="btn-primary text-lg">âœ¨ é‡æ–°ç”Ÿæˆè®¾è®¡</button><button data-action="save-ui" class="btn-secondary">ğŸ’¾ ä¿å­˜UI (HTML)</button></div></div><div id="ui-mockup-container" class="mockup-container"></div></div></div>`; injectPaletteAsCssVariables(aiData.palette); const delay = ms => new Promise(res => setTimeout(res, ms)); const typeText = async (el, text) => { el.innerHTML = ''; for (let i = 0; i < text.length; i++) { el.innerHTML += text[i]; await delay(25); } }; const colorContainer = document.getElementById('main-color-container'), descContainer = document.getElementById('description-container'); await delay(100); await typeText(document.getElementById('detail-title'), aiData.name); document.querySelector('#main-color-block').classList.add('visible'); await delay(300); colorContainer.style.flexBasis = '34%'; descContainer.style.flexBasis = '66%'; descContainer.style.opacity = '1'; const descSection = document.getElementById('detail-description'); descSection.classList.add('visible'); await typeText(descSection.querySelector('p'), `"${aiData.description}"`); await delay(400); document.querySelector('.reveal-item.mb-8').classList.add('visible'); const paletteContainer = document.getElementById('palette-container'); for (const [i, key] of Object.keys(aiData.palette).entries()) { await delay(150); const scheme = aiData.palette[key]; const item = document.createElement('div'); item.className = 'palette-card opacity-0'; item.style.setProperty('--primary-color', scheme.color); item.style.transition = 'opacity 0.5s ease, transform 0.5s ease'; item.style.transform = `perspective(500px) rotateX(-20deg) translateX(${i % 2 === 0 ? '-' : ''}10px)`; item.innerHTML = `<div class="flex items-start space-x-4"><div class="w-20 h-20 rounded-2xl flex-shrink-0 shadow-lg border-2 border-white relative overflow-hidden" style="background-color: ${scheme.color};"><div class="absolute inset-0 bg-gradient-to-br from-white/20 to-transparent"></div></div><div class="flex-grow"><h4 class="text-xl font-bold text-gray-800 mb-2">${scheme.name}</h4><p class="text-gray-600 mb-3 leading-relaxed">${scheme.description}</p><div class="flex items-center space-x-4 text-sm"><span class="bg-gray-100 px-3 py-1 rounded-full font-mono font-semibold cursor-pointer transition-colors hover:bg-gray-200" data-copy-text="${scheme.color.toUpperCase()}">${scheme.color.toUpperCase()}</span></div></div></div>`; paletteContainer.appendChild(item); void item.offsetWidth; item.style.opacity = '1'; item.style.transform = 'perspective(500px) rotateX(0deg) translateX(0)'; } await delay(500); document.querySelectorAll('.reveal-item')[document.querySelectorAll('.reveal-item').length-1].classList.add('visible'); triggerAutomaticMockupGeneration(); }
        
        // *** UPGRADED: Function to create a standalone HTML file ***
        function createStandaloneHtml(uiHtml, paletteData) {
            const palette = paletteData.palette;
            const cssVariables = `:root { --color-primary: ${palette.primary.color}; --color-secondary: ${palette.secondary?.color || palette.analogous.color}; --color-accent: ${palette.accent?.color || palette.complementary.color}; --color-background: ${palette.background?.color || palette.neutral.color}; }`;
            const buildInAnimation = `@keyframes build-in-up { from { opacity: 0; transform: translateY(30px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } } .build-in-item { opacity: 0; animation-name: build-in-up; animation-duration: 0.7s; animation-fill-mode: forwards; animation-timing-function: cubic-bezier(0.215, 0.610, 0.355, 1); }`;
            const htmlContent = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Generated UI: ${paletteData.name}</title>
    <script src="https://cdn.tailwindcss.com"><\/script>
    <style>
        body { display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f0f2f5; font-family: sans-serif; }
        ${cssVariables}
        ${buildInAnimation}
    <\/style>
</head>
<body>
    ${uiHtml}
    <script>
        // Trigger build-in animation on load
        document.addEventListener('DOMContentLoaded', () => {
            const allElements = document.querySelectorAll('.build-in-item');
            allElements.forEach((el, index) => {
                el.style.animationDelay = \`\${index * 40}ms\`;
            });
        });
    <\/script>
</body>
</html>`;
            return htmlContent.trim();
        }

        function downloadAsFile(filename, content) {
            const element = document.createElement('a');
            const file = new Blob([content], {type: 'text/html'});
            element.href = URL.createObjectURL(file);
            element.download = filename;
            document.body.appendChild(element); // Required for this to work in FireFox
            element.click();
            document.body.removeChild(element);
            URL.revokeObjectURL(element.href);
        }

        // *** NEW: API Key Modal Logic ***
        function openApiKeyModal() { elements.apiKeyInput.value = API_KEY; elements.apiKeyModal.classList.add('visible'); elements.apiKeyInput.focus(); }
        function closeApiKeyModal() { elements.apiKeyModal.classList.remove('visible'); }
        function saveApiKey() { const newKey = elements.apiKeyInput.value.trim(); if (newKey) { API_KEY = newKey; localStorage.setItem('geminiApiKey', newKey); closeApiKeyModal(); alert('API Keyå·²ä¿å­˜ï¼'); } else { alert('API Keyä¸èƒ½ä¸ºç©ºã€‚'); } }
        function checkApiKey() { if (!API_KEY) { openApiKeyModal(); return false; } return true; }

        // ======================== Event Handlers & Init ========================
        async function handleGridClick(event) { if (!checkApiKey()) return; const colorBlock = event.target.closest('.color-block'); if (colorBlock) { renderSkeleton(); const aiDetails = await getColorDetails(colorBlock.dataset.color); await renderDetailPageStreamed(aiDetails); } }
        async function handleTextGenerateClick() { if (!checkApiKey()) return; const description = elements.textInput.value.trim(); if (!description) { elements.textInput.parentElement.parentElement.style.animation = 'shake 0.5s ease-in-out'; elements.textInput.focus(); setTimeout(() => { elements.textInput.parentElement.parentElement.style.animation = ''; }, 500); return; } elements.textGenerateBtn.disabled = true; elements.textGenerateBtn.innerHTML = '<div class="loader-container !h-auto !my-[-16px]"><div class="loader"><div class="loader-bar !w-1 !h-4"></div><div class="loader-bar !w-1 !h-4"></div><div class="loader-bar !w-1 !h-4"></div></div></div>'; renderSkeleton(); const aiDetails = await getColorDetailsFromText(description); elements.textGenerateBtn.disabled = false; elements.textGenerateBtn.innerHTML = 'ğŸ¨ ç”Ÿæˆä¸“å±é…è‰²æ–¹æ¡ˆ'; await renderDetailPageStreamed(aiDetails); }
        async function handleDetailViewClick(event) { const button = event.target.closest('button[data-action]'); const copyTarget = event.target.closest('[data-copy-text]'); if(copyTarget) { copyToClipboard(copyTarget.dataset.copyText, copyTarget); return; } if (!button) return; const action = button.dataset.action; if (action === 'back') { switchView('grid'); } if (action === 'generate-mockup') { if (checkApiKey()) triggerAutomaticMockupGeneration(); } if (action === 'save-ui') { const uiContainer = document.getElementById('ui-mockup-container'); if (uiContainer && uiContainer.innerHTML.trim() !== '' && !uiContainer.querySelector('.loader-container')) { const standaloneHtml = createStandaloneHtml(uiContainer.innerHTML, state.currentPaletteData); downloadAsFile('ai-generated-ui.html', standaloneHtml); } else { alert('æ²¡æœ‰å¯ä»¥ä¿å­˜çš„UIï¼Œè¯·å…ˆç”Ÿæˆä¸€ä¸ªã€‚'); } } if (action === 'copy-palette') { const palette = state.currentPaletteData?.palette; if (!palette) return; let cssVars = ":root {\n"; cssVars += `  --color-primary: ${palette.primary.color};\n`; cssVars += `  --color-secondary: ${palette.secondary?.color || palette.analogous.color};\n`; cssVars += `  --color-accent: ${palette.accent?.color || palette.complementary.color};\n`; cssVars += `  --color-background: ${palette.background?.color || palette.neutral.color};\n`; cssVars += "}"; copyToClipboard(cssVars, button); } }
        function init() { initCanvas(); startAnimation(); populateScrollingWalls(); elements.wallContainer.addEventListener('click', handleGridClick); elements.refreshBtn.addEventListener('click', (e) => { const icon = e.currentTarget.querySelector('svg'); icon.style.transition = 'transform 0.5s ease'; icon.style.transform = 'rotate(360deg)'; setTimeout(() => { icon.style.transition = 'none'; icon.style.transform = ''; populateScrollingWalls(); }, 500); }); elements.textGenerateBtn.addEventListener('click', handleTextGenerateClick); elements.detailPage.addEventListener('click', handleDetailViewClick); elements.settingsBtn.addEventListener('click', openApiKeyModal); elements.apiKeyCancelBtn.addEventListener('click', closeApiKeyModal); elements.apiKeySaveBtn.addEventListener('click', saveApiKey); document.addEventListener('keydown', function(e) { if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) { if (elements.textInput === document.activeElement) handleTextGenerateClick(); } if (e.key === 'Escape') { if (!elements.detailPage.classList.contains('hidden')) { switchView('grid'); } else if(elements.apiKeyModal.classList.contains('visible')) { closeApiKeyModal(); } } }); const style = document.createElement('style'); style.textContent = `@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }`; document.head.appendChild(style); document.addEventListener('visibilitychange', () => { document.hidden ? stopAnimation() : startAnimation(); }); window.addEventListener('mousemove', () => { startAnimation(); clearTimeout(inactivityTimer); inactivityTimer = setTimeout(stopAnimation, 5000); }); window.addEventListener('resize', () => { initCanvas(); startAnimation(); }); }
        init();
    </script>
</body>
</html>
